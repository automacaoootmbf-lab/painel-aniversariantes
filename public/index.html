<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Painel de Aniversariantes ‚Äî Dashboard</title>
  <meta name="description" content="Painel corporativo de aniversariantes com calend√°rio, lista, estat√≠sticas e importa√ß√£o CSV." />
  <meta name="theme-color" content="#10b981">

  <!-- Fonte + √≠cones -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <style>
    :root{
      --bg-light: #f5faf7;
      --card-light: #ffffff;
      --text-light: #020617;
      --muted-light: #4b5563;
      --bg-dark: #020817;
      --card-dark: #020c1b;
      --text-dark: #e5f4ff;
      --muted-dark: #9ca3af;
      --accent-green: #10b981;
      --accent-blue: #0ea5e9;
      --danger: #ef4444;
      --contrast-border-light: rgba(15,23,42,0.08);
      --contrast-border-dark: rgba(148,163,184,0.35);
      --elevation: 0 18px 38px rgba(15,23,42,0.35);
      --radius-lg: 18px;
      --radius-md: 12px;
      --nav-height: 64px;
    }

    [data-theme="light"]{
      --bg: var(--bg-light);
      --card: var(--card-light);
      --text: var(--text-light);
      --muted: var(--muted-light);
      --accent: var(--accent-green);
      --accent2: var(--accent-blue);
      --contrast-border: var(--contrast-border-light);
    }
    [data-theme="dark"]{
      --bg: var(--bg-dark);
      --card: var(--card-dark);
      --text: var(--text-dark);
      --muted: var(--muted-dark);
      --accent: var(--accent-green);
      --accent2: var(--accent-blue);
      --contrast-border: var(--contrast-border-dark);
    }

    /* select leg√≠vel nos dois temas */
    select{
      background-color: var(--card);
      color: var(--text);
    }
    select option{
      background-color: var(--card);
      color: var(--text);
    }
    [data-theme="dark"] select{
      background-color: var(--card-dark);
      color: var(--text-dark);
    }
    [data-theme="dark"] select option{
      background-color: var(--card-dark);
      color: var(--text-dark);
    }

    *,*::before,*::after{box-sizing:border-box}
    html,body{
      height:100%;
      margin:0;
      background:radial-gradient(circle at top, rgba(56,189,248,0.15), transparent 50%) , var(--bg);
      color:var(--text);
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
      line-height:1.35;
    }
    :focus{
      outline:2px solid color-mix(in srgb, var(--accent) 40%, transparent);
      outline-offset:3px;
    }
    @media (prefers-reduced-motion: reduce){
      *{
        animation-duration:0.001ms !important;
        transition-duration:0.001ms !important;
      }
    }

    .shell{
      min-height:100vh;
      max-width:1180px;
      margin:0 auto;
      padding:18px 18px 32px;
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    /* HEADER / NAVBAR */
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:10px 16px;
      border-radius:999px;
      background:linear-gradient(90deg, rgba(15,23,42,0.08), transparent);
      border:1px solid var(--contrast-border);
      box-shadow:0 20px 60px rgba(15,23,42,0.32);
      backdrop-filter:blur(18px);
      position:sticky;
      top:10px;
      z-index:40;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .brand-logo{
      width:40px;
      height:40px;
      border-radius:999px;
      background:conic-gradient(from 220deg, var(--accent2), var(--accent), #22c55e);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#f9fafb;
      font-size:20px;
      box-shadow:0 10px 24px rgba(16,185,129,0.45);
    }
    .brand-text h1{
      margin:0;
      font-size:18px;
      font-weight:600;
      letter-spacing:0.03em;
    }
    .brand-text p{
      margin:0;
      font-size:12px;
      color:var(--muted);
    }

    .nav-tabs{
      display:flex;
      align-items:center;
      gap:6px;
      border-radius:999px;
      padding:4px;
      background:rgba(15,23,42,0.4);
    }
    .nav-tab{
      position:relative;
      border:none;
      border-radius:999px;
      padding:6px 14px;
      font-size:13px;
      display:flex;
      align-items:center;
      gap:6px;
      background:transparent;
      color:var(--muted);
      cursor:pointer;
      transition:background .18s ease, color .18s ease, transform .12s ease;
    }
    .nav-tab i{
      font-size:13px;
    }
    .nav-tab[data-active="true"]{
      background:linear-gradient(90deg,var(--accent2),var(--accent));
      color:#f9fafb;
      box-shadow:0 10px 25px rgba(15,23,42,0.55);
      transform:translateY(-1px);
    }
    .nav-tab[data-active="true"]::after{
      content:'';
      position:absolute;
      left:16px;
      right:16px;
      bottom:-6px;
      height:3px;
      border-radius:999px;
      background:linear-gradient(90deg,var(--accent2),var(--accent));
      opacity:.9;
    }

    .header-actions{
      display:flex;
      align-items:center;
      gap:8px;
    }

    .btn{
      appearance:none;
      border-radius:999px;
      border:1px solid transparent;
      padding:7px 12px;
      font-size:13px;
      font-weight:500;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:linear-gradient(90deg,var(--accent2),var(--accent));
      color:#f9fafb;
      box-shadow:0 8px 20px rgba(16,185,129,0.4);
      transition:transform .12s ease, box-shadow .12s ease, background .18s ease;
    }
    .btn:hover{
      transform:translateY(-1px);
      box-shadow:0 12px 26px rgba(15,23,42,0.5);
    }
    .btn-ghost{
      background:transparent;
      color:var(--muted);
      border-color:var(--contrast-border);
      box-shadow:none;
    }
    .btn-ghost:hover{
      background:rgba(15,23,42,0.18);
      color:var(--text);
    }
    .btn-icon{
      width:34px;
      height:34px;
      padding:0;
      align-items:center;
      justify-content:center;
      border-radius:999px;
    }

    main{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    /* Cada p√°gina √© exclusiva; s√≥ a ativa aparece */
    .page{
      display:none;
      animation:fadeIn .3s ease both;
    }
    .page.active{
      display:block;
    }

    .page-grid{
      display:grid;
      grid-template-columns:2.1fr 1.1fr;
      gap:18px;
      align-items:flex-start;
    }
    .page-full{
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    @media(max-width:980px){
      header{
        flex-wrap:wrap;
        border-radius:18px;
        align-items:flex-start;
      }
      .nav-tabs{
        flex-wrap:wrap;
        width:100%;
        justify-content:center;
      }
      .page-grid{
        grid-template-columns:1fr;
      }
    }

    .card{
      background:radial-gradient(circle at top left, rgba(56,189,248,0.14), transparent 55%), var(--card);
      border-radius:var(--radius-lg);
      padding:18px 18px 16px;
      border:1px solid var(--contrast-border);
      box-shadow:0 16px 35px rgba(15,23,42,0.25);
      position:relative;
      overflow:hidden;
    }
    .card-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      margin-bottom:10px;
    }
    .card-title{
      font-size:16px;
      font-weight:600;
    }
    .card-sub{
      font-size:13px;
      color:var(--muted);
    }

    .pill{
      font-size:12px;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(15,23,42,0.25);
      color:var(--muted);
    }

    .today-highlight{
      font-size:14px;
      margin-top:6px;
    }

    .list-inline{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:6px;
    }
    .person-row{
      display:flex;
      align-items:flex-start;
      gap:10px;
      padding:8px 0;
      border-bottom:1px solid rgba(148,163,184,0.2);
    }
    .person-row:last-child{
      border-bottom:none;
    }
    .avatar{
      width:36px;
      height:36px;
      border-radius:12px;
      background:linear-gradient(135deg,var(--accent2),var(--accent));
      display:flex;
      align-items:center;
      justify-content:center;
      color:white;
      font-size:15px;
      font-weight:600;
      box-shadow:0 8px 18px rgba(16,185,129,0.45);
    }
    .person-main{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .person-name{
      font-size:14px;
      font-weight:500;
    }
    .person-meta{
      font-size:12px;
      color:var(--muted);
    }

    .calendar-grid{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:8px;
      margin-top:8px;
    }
    .day-cell{
      min-height:90px;
      border-radius:14px;
      padding:8px;
      border:1px dashed rgba(148,163,184,0.4);
      position:relative;
      background:linear-gradient(180deg, rgba(15,23,42,0.25), transparent);
      font-size:12px;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .day-num{
      position:absolute;
      right:8px;
      top:6px;
      font-size:11px;
      color:var(--muted);
      font-weight:500;
    }
    .day-badge{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }
    th,td{
      padding:10px 8px;
      border-bottom:1px solid rgba(148,163,184,0.25);
      text-align:left;
    }
    th{
      color:var(--accent);
      font-weight:600;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:0.05em;
    }
    tbody tr:hover{
      background:linear-gradient(90deg,rgba(15,23,42,0.32),transparent);
    }
    .table-actions{
      display:flex;
      justify-content:flex-end;
      gap:4px;
    }
    .icon-btn{
      border:none;
      border-radius:999px;
      width:26px;
      height:26px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      background:rgba(15,23,42,0.55);
      color:var(--muted);
      cursor:pointer;
      font-size:12px;
    }
    .icon-btn:hover{
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
    }

    .input, .input-sm{
      border-radius:999px;
      border:1px solid var(--contrast-border);
      background:rgba(15,23,42,0.08);
      color:var(--text);
      padding:8px 10px;
      font-size:13px;
    }
    .input-sm{
      padding:6px 9px;
      font-size:12px;
    }
    .input::placeholder{
      color:var(--muted);
    }

    .chips-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:4px;
    }

    .badge-soft{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      background:rgba(15,23,42,0.35);
      color:var(--muted);
    }

    .page-title{
      font-size:18px;
      font-weight:600;
      margin:0 0 2px;
    }

    .page-sub{
      font-size:13px;
      color:var(--muted);
      margin:0;
    }

    .footer-card{
      margin-top:10px;
      border-radius:18px;
      padding:10px 16px;
      border:1px solid var(--contrast-border);
      background:linear-gradient(90deg,rgba(15,23,42,0.55),transparent);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      font-size:12px;
      color:var(--muted);
    }
    .footer-right{
      display:flex;
      align-items:center;
      gap:10px;
    }

    #toast{
      position:fixed;
      right:20px;
      bottom:20px;
      padding:12px 16px;
      border-radius:999px;
      background:var(--accent);
      color:white;
      box-shadow:0 18px 40px rgba(15,23,42,0.7);
      transform:translateY(14px);
      opacity:0;
      transition:all .24s ease;
      z-index:10020;
      font-size:13px;
    }
    #toast.show{
      opacity:1;
      transform:translateY(0);
    }

    dialog{border:none}
    .dialog{
      padding:16px;
      background:var(--card);
      border-radius:16px;
      min-width:320px;
      border:1px solid var(--contrast-border);
      box-shadow:var(--elevation);
    }
    .dialog h3{
      margin-top:0;
      margin-bottom:8px;
      font-size:16px;
    }

    #confetti-canvas{
      position:fixed;
      left:0;
      top:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:9999;
    }
    #balloon-wrap{
      position:fixed;
      left:0;
      top:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:9980;
    }

    .admin-only{display:none}
    .admin-visible{display:inline-flex}
    .small{font-size:12px;color:var(--muted)}

    .tag-green{
      color:#22c55e;
      font-weight:500;
    }

    @keyframes fadeIn{
      from{opacity:0;transform:translateY(6px);}
      to{opacity:1;transform:none;}
    }
  </style>
</head>

<body data-theme="light" lang="pt-BR">
  <!-- Config Firebase via GitHub Action -->
  <script src="/firebase-config.js"></script>

  <canvas id="confetti-canvas" aria-hidden="true"></canvas>
  <div id="balloon-wrap" aria-hidden="true"></div>
  <div id="toast" role="status" aria-live="polite"></div>

  <div class="shell">
    <!-- HEADER / NAV -->
    <header>
      <div class="brand">
        <div class="brand-logo" aria-hidden="true">üéÇ</div>
        <div class="brand-text">
          <h1>Painel de Aniversariantes</h1>
          <p>Vis√£o r√°pida ‚Ä¢ Calend√°rio ‚Ä¢ Estat√≠sticas ‚Ä¢ Export/Import</p>
        </div>
      </div>

      <nav class="nav-tabs" aria-label="Se√ß√µes do painel">
        <button class="nav-tab" data-view="home" data-active="true"><i class="fa-solid fa-house"></i><span>Hoje</span></button>
        <button class="nav-tab" data-view="calendar"><i class="fa-solid fa-calendar-days"></i><span>Calend√°rio</span></button>
        <button class="nav-tab" data-view="list"><i class="fa-solid fa-list"></i><span>Lista</span></button>
        <button class="nav-tab" data-view="future"><i class="fa-solid fa-forward"></i><span>Futuros</span></button>
        <button class="nav-tab" data-view="charts"><i class="fa-solid fa-chart-simple"></i><span>Gr√°ficos</span></button>
      </nav>

      <div class="header-actions">
        <button id="theme-toggle" class="btn-ghost btn-icon" aria-pressed="false" title="Alternar modo claro/escuro">
          <i class="fa-solid fa-moon"></i>
        </button>
        <button id="celebrate-btn" class="btn" title="Celebrar aniversariantes">
          <i class="fa-solid fa-champagne-glasses"></i><span>Celebrar</span>
        </button>
        <button id="auth-btn" class="btn-ghost">
          <i class="fa-solid fa-lock"></i><span>Entrar</span>
        </button>
      </div>
    </header>

    <!-- MAIN -->
    <main>
      <!-- HOME (exclusivo: s√≥ hoje + pr√≥ximos 5 dias + vis√£o do sistema) -->
      <section id="view-home" class="page page-grid active" aria-label="Vis√£o de hoje">
        <div class="card">
          <div class="card-header">
            <div>
              <p class="page-title">Hoje</p>
              <p class="page-sub" id="today-sub">Resumo do dia</p>
            </div>
            <span class="pill" id="today-count">‚Äî</span>
          </div>
          <div id="today-content" class="today-highlight">Carregando...</div>

          <div style="margin-top:14px;">
            <div class="card-header" style="margin-bottom:6px;">
              <div>
                <div class="card-title" style="font-size:14px;">Pr√≥ximos 5 dias</div>
                <div class="card-sub">Vis√£o r√°pida dos aniversariantes mais pr√≥ximos.</div>
              </div>
            </div>
            <div id="home-upcoming" class="list-inline">Carregando...</div>
          </div>
        </div>

        <aside class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Vis√£o do sistema</div>
              <div class="card-sub">Tema, idioma e vers√£o do painel.</div>
            </div>
          </div>
          <div class="chips-row">
            <span class="badge-soft"><strong>Tema:</strong> <span id="current-theme">Claro</span></span>
            <span class="badge-soft"><strong>Idioma:</strong>
              <select id="locale-select" class="input-sm" aria-label="Selecione o idioma">
                <option value="pt-BR">pt-BR</option>
                <option value="en-US">en-US</option>
              </select>
            </span>
            <span class="badge-soft"><strong>Vers√£o:</strong> <span id="ver-info">v1.0.3 ‚Ä¢ Internacionaliza√ß√£o pronta</span></span>
          </div>
          <p class="small" style="margin-top:10px;">
            <span class="tag-green">Dica:</span> pressione <code>C</code> para celebrar de qualquer lugar da p√°gina.
          </p>
        </aside>
      </section>
      <!-- CALEND√ÅRIO (exclusivo) -->
      <section id="view-calendar" class="page page-grid" aria-label="Calend√°rio de anivers√°rios">
        <div class="card">
          <div class="card-header">
            <div>
              <p class="page-title">Calend√°rio</p>
              <p class="page-sub">Visualiza√ß√£o mensal dos anivers√°rios cadastrados.</p>
            </div>
          </div>
          <div id="calendar-month-label" class="small" style="margin-bottom:4px;">M√™s atual</div>
          <div id="calendar-grid" class="calendar-grid"></div>
        </div>

        <aside class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Resumo r√°pido</div>
              <div class="card-sub">Total por dia e por m√™s.</div>
            </div>
          </div>
          <p class="small" id="calendar-summary">Carregando dados...</p>
        </aside>
      </section>

      <!-- LISTA (exclusivo: s√≥ tabela + a√ß√µes r√°pidas) -->
      <section id="view-list" class="page page-grid" aria-label="Lista completa de aniversariantes">
        <div class="card">
          <div class="card-header">
            <div>
              <p class="page-title">Lista completa</p>
              <p class="page-sub">Busque, filtre e gerencie todos os aniversariantes.</p>
            </div>

            <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end;">
              <div style="display:flex;gap:6px;align-items:center;">
                <input id="search-input" type="search" class="input" placeholder="Buscar por nome ou setor" aria-label="Buscar aniversariantes">
                <button id="add-btn" class="btn-ghost admin-only" title="Adicionar aniversariante">
                  <i class="fa-solid fa-plus"></i>
                </button>
              </div>

              <div style="display:flex;gap:6px;align-items:center;justify-content:flex-end;">
                <select id="month-filter" class="input-sm" aria-label="Filtrar por m√™s">
                  <option value="all">Todos os meses</option>
                  <option value="1">Jan</option><option value="2">Fev</option><option value="3">Mar</option>
                  <option value="4">Abr</option><option value="5">Mai</option><option value="6">Jun</option>
                  <option value="7">Jul</option><option value="8">Ago</option><option value="9">Set</option>
                  <option value="10">Out</option><option value="11">Nov</option><option value="12">Dez</option>
                </select>
              </div>
            </div>
          </div>

          <div id="list-wrapper">Carregando...</div>

          <div style="display:flex;justify-content:center;margin-top:8px;">
            <button id="load-more" class="btn-ghost" style="font-size:12px;padding:6px 12px;">
              Carregar mais
            </button>
          </div>
        </div>

        <aside class="card">
          <div class="card-header">
            <div>
              <div class="card-title">A√ß√µes r√°pidas</div>
              <div class="card-sub">Importe, exporte ou atualize em massa.</div>
            </div>
          </div>

          <p class="small" id="actions-sub">
            A√ß√µes administrativas dispon√≠veis somente para usu√°rios autenticados.
          </p>

          <div style="display:flex;flex-direction:column;gap:10px;margin-top:10px;">
            <input id="csv-file" class="admin-only input-sm" type="file" accept=".csv" aria-label="Importar CSV">

            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <button id="import-sample" class="btn-ghost admin-only" style="font-size:12px;padding:6px 10px;">
                Importar exemplo
              </button>
              <button id="export-csv" class="btn-ghost" style="font-size:12px;padding:6px 10px;">
                Exportar CSV
              </button>
            </div>
          </div>
        </aside>
      </section>

      <!-- FUTUROS (exclusivo: vis√£o longa de pr√≥ximos dias) -->
      <section id="view-future" class="page page-full" aria-label="Pr√≥ximos anivers√°rios">
        <div class="card">
          <div class="card-header">
            <div>
              <p class="page-title">Pr√≥ximos aniversariantes</p>
              <p class="page-sub">Vis√£o estendida dos anivers√°rios que ainda v√£o acontecer.</p>
            </div>

            <div style="display:flex;align-items:center;gap:8px;">
              <span class="small">Pr√≥ximos</span>
              <input id="days-ahead" type="number" min="1" max="365" value="30" class="input-sm" style="width:80px;">
              <button id="refresh-future" class="btn-ghost" style="font-size:12px;padding:6px 10px;">
                Atualizar
              </button>
            </div>
          </div>

          <div id="future-list" class="list-inline">Carregando...</div>
        </div>
      </section>

      <!-- GR√ÅFICOS (exclusivo) -->
      <section id="view-charts" class="page page-grid" aria-label="Gr√°ficos e estat√≠sticas">
        <div class="card">
          <div class="card-header">
            <div>
              <p class="page-title">Distribui√ß√£o por m√™s</p>
              <p class="page-sub">Quantidade de aniversariantes em cada m√™s.</p>
            </div>
          </div>

          <canvas id="chart-monthly" style="width:100%;height:260px;margin-top:10px"></canvas>
        </div>

        <aside class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Insights r√°pidos</div>
              <div class="card-sub">Meses mais cheios e vazios.</div>
            </div>
          </div>

          <div class="small" id="charts-summary">Carregando...</div>
        </aside>
      </section>
    </main>

    <!-- FOOTER / INFO -->
    <div class="footer-card">
      <span>üéÇ Painel de Aniversariantes ‚Ä¢ <span id="footer-version">v1.0.3</span></span>
      <div class="footer-right">
        <span>Idioma atual: <strong id="footer-locale">pt-BR</strong></span>
        <span>Tema: <strong id="footer-theme">Claro</strong></span>
      </div>
    </div>
  </div>

  <!-- Modal de login -->
  <dialog id="login-modal" aria-labelledby="login-heading">
    <div class="dialog">
      <h3 id="login-heading">Login administrativo</h3>
      <p class="small" style="margin-bottom:10px;">
        Use seu usu√°rio e senha autorizados para gerenciar os aniversariantes.
      </p>
      <form id="login-form">
        <label class="small">E-mail
          <input id="login-email" type="email" required class="input" style="width:100%;margin-top:4px;">
        </label>

        <label class="small" style="margin-top:8px;">Senha
          <input id="login-pass" type="password" required class="input" style="width:100%;margin-top:4px;">
        </label>

        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
          <button type="button" id="login-close" class="btn-ghost">Fechar</button>
          <button type="submit" class="btn">Entrar</button>
        </div>
      </form>
    </div>
  </dialog>

  <!-- Modal de edi√ß√£o / cria√ß√£o -->
  <dialog id="edit-modal" aria-labelledby="edit-heading">
    <div class="dialog">
      <h3 id="edit-heading">Editar aniversariante</h3>
      <form id="edit-form">
        <input type="hidden" id="edit-id">

        <label class="small">Nome
          <input id="edit-nome" type="text" required class="input" style="width:100%;margin-top:4px;">
        </label>

        <label class="small" style="margin-top:8px;">Setor
          <input id="edit-setor" type="text" required class="input" style="width:100%;margin-top:4px;">
        </label>

        <div style="display:flex;gap:8px;margin-top:8px;">
          <label class="small" style="flex:1;">Dia
            <input id="edit-dia" type="number" min="1" max="31" required class="input" style="width:100%;margin-top:4px;">
          </label>
          <label class="small" style="flex:1;">M√™s
            <input id="edit-mes" type="number" min="1" max="12" required class="input" style="width:100%;margin-top:4px;">
          </label>
        </div>

        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
          <button type="button" id="edit-cancel" class="btn-ghost">Cancelar</button>
          <button type="submit" class="btn">Salvar</button>
        </div>
      </form>
    </div>
  </dialog>

  <!-- Modal de confirma√ß√£o de exclus√£o -->
  <dialog id="confirm-modal" aria-labelledby="confirm-heading">
    <div class="dialog">
      <h3 id="confirm-heading">Excluir aniversariante</h3>
      <p class="small" id="confirm-text">Tem certeza que deseja excluir?</p>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
        <button type="button" id="confirm-no" class="btn-ghost">Cancelar</button>
        <button type="button" id="confirm-yes" class="btn">Excluir</button>
      </div>
    </div>
  </dialog>

  <!-- Som simples para celebra√ß√£o -->
  <audio id="celebrate-audio" preload="auto">
    <source src="https://actions.google.com/sounds/v1/ambiences/crowd_cheer.ogg" type="audio/ogg">
  </audio>
  <!-- Bibliotecas JS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signInWithEmailAndPassword,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import {
      getFirestore,
      collection,
      getDocs,
      setDoc,
      addDoc,
      deleteDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    // Usa config injetada pelo firebase-config.js
    const app = initializeApp(window.firebaseConfig || firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);
    const colRef = collection(db, "aniversariantes");

    // ---------------- VARI√ÅVEIS DE ESTADO ----------------
    let dataArr = [];        // todos os aniversariantes
    let listShown = 30;      // pagina√ß√£o da lista
    let isAdmin = false;     // controle de permiss√µes
    let chart = null;        // inst√¢ncia do Chart.js
    let currentLocale = localStorage.getItem("bday-locale") || "pt-BR";

    // ---------------- HELPERS GERAIS ----------------
    const $  = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function showToast(msg, type = "ok") {
      const el = $("#toast");
      if (!el) return;
      el.textContent = msg;
      el.style.background = type === "error" ? "var(--danger)" : "var(--accent)";
      el.classList.add("show");
      setTimeout(() => el.classList.remove("show"), 2800);
    }

    function setTheme(theme) {
      const body = document.body;
      body.setAttribute("data-theme", theme);
      localStorage.setItem("bday-theme", theme);
      const isDark = theme === "dark";

      // √çcone e textos
      const themeBtn = $("#theme-toggle i");
      if (themeBtn) {
        themeBtn.className = isDark ? "fa-solid fa-sun" : "fa-solid fa-moon";
      }
      const themeText = $("#current-theme");
      const footerTheme = $("#footer-theme");
      if (themeText) themeText.textContent = isDark ? "Escuro" : "Claro";
      if (footerTheme) footerTheme.textContent = isDark ? "Escuro" : "Claro";
    }

    function initTheme() {
      const saved = localStorage.getItem("bday-theme");
      const prefersDark = window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;
      setTheme(saved || (prefersDark ? "dark" : "light"));
    }

    function setLocale(locale) {
      currentLocale = locale;
      localStorage.setItem("bday-locale", locale);
      const footerLocale = $("#footer-locale");
      if (footerLocale) footerLocale.textContent = locale;
      const select = $("#locale-select");
      if (select && select.value !== locale) select.value = locale;
      // re-renderiza textos dependentes de data
      renderToday();
      renderHomeUpcoming();
      renderCalendar();
      renderFuturePage();
    }

    function formatDayMonth(dia, mes) {
      const d = new Date(2000, mes - 1, dia);
      return d.toLocaleDateString(currentLocale, { day: "2-digit", month: "2-digit" });
    }

    function formatLongDate(dia, mes) {
      const d = new Date(2000, mes - 1, dia);
      const optsBR = { day: "2-digit", month: "long" };
      const optsEN = { day: "2-digit", month: "short" };
      const opts = currentLocale === "pt-BR" ? optsBR : optsEN;
      return d.toLocaleDateString(currentLocale, opts);
    }

    function nextOccurrenceDate(dia, mes) {
      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      let year = now.getFullYear();
      const thisYear = new Date(year, mes - 1, dia);
      if (thisYear < today) year += 1;
      return new Date(year, mes - 1, dia);
    }

    function daysDiffFromToday(dia, mes) {
      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      const target = nextOccurrenceDate(dia, mes);
      const diffMs = target - today;
      return Math.round(diffMs / (1000 * 60 * 60 * 24));
    }

    function sortByDateThenName(a, b) {
      if (a.mes !== b.mes) return a.mes - b.mes;
      if (a.dia !== b.dia) return a.dia - b.dia;
      return (a.nome || "").localeCompare(b.nome || "", "pt-BR");
    }

    function upperSetor(setor) {
      return (setor || "").toString().trim().toUpperCase();
    }

    function updateAdminUI() {
      $$(".admin-only").forEach(el => {
        el.style.display = isAdmin ? "" : "none";
      });
      const authBtn = $("#auth-btn");
      if (authBtn) {
        authBtn.innerHTML = isAdmin
          ? '<i class="fa-solid fa-right-from-bracket"></i><span>Sair</span>'
          : '<i class="fa-solid fa-lock"></i><span>Entrar</span>';
      }
    }

    // ---------------- NAVEGA√á√ÉO ENTRE ABAS ----------------
    function initTabs() {
      const tabs = $$(".nav-tab");
      const pages = {
        home: $("#view-home"),
        calendar: $("#view-calendar"),
        list: $("#view-list"),
        future: $("#view-future"),
        charts: $("#view-charts")
      };

      function activate(view) {
        tabs.forEach(btn => {
          const active = btn.dataset.view === view;
          btn.dataset.active = active ? "true" : "false";
        });
        Object.entries(pages).forEach(([key, section]) => {
          if (!section) return;
          section.classList.toggle("active", key === view);
        });
      }

      tabs.forEach(btn => {
        btn.addEventListener("click", () => activate(btn.dataset.view));
      });

      // aba inicial
      activate("home");
    }

    // ---------------- CELEBRA√á√ÉO (CONFETTI + SOM) ----------------
    function initCelebrate() {
      const canvas = $("#confetti-canvas");
      let shoot = null;
      if (canvas && window.confetti) {
        shoot = window.confetti.create(canvas, { resize: true, useWorker: true });
      }

      function fireCelebration() {
        if (shoot) {
          shoot({
            particleCount: 200,
            spread: 80,
            origin: { y: 0.6 }
          });
          setTimeout(() => {
            shoot({
              particleCount: 120,
              spread: 110,
              origin: { y: 0.3 }
            });
          }, 250);
        }
        const audio = $("#celebrate-audio");
        if (audio) {
          audio.currentTime = 0;
          audio.play().catch(() => {});
        }
      }

      const btn = $("#celebrate-btn");
      if (btn) btn.addEventListener("click", fireCelebration);
      window.addEventListener("keydown", ev => {
        if (ev.key.toLowerCase() === "c") fireCelebration();
      });
    }

    // ---------------- FIRESTORE: CARREGAMENTO ----------------
    async function loadData() {
      const listWrapper = $("#list-wrapper");
      if (listWrapper) listWrapper.textContent = "Carregando...";

      try {
        const snapshot = await getDocs(colRef);
        dataArr = snapshot.docs.map(d => {
          const raw = d.data();
          return {
            id: d.id,
            nome: raw.nome || "",
            setor: upperSetor(raw.setor || ""),
            dia: Number(raw.dia) || 1,
            mes: Number(raw.mes) || 1
          };
        });
        dataArr.sort(sortByDateThenName);
        renderEverything();
        showToast("Dados carregados com sucesso.");
      } catch (err) {
        console.error(err);
        if (listWrapper) listWrapper.textContent = "Erro ao carregar dados.";
        showToast("Erro ao carregar dados.", "error");
      }
    }

    // ---------------- RENDER: HOJE ----------------
    function renderToday() {
      const now = new Date();
      const diaHoje = now.getDate();
      const mesHoje = now.getMonth() + 1;

      const container = $("#today-content");
      const sub = $("#today-sub");
      const pill = $("#today-count");
      if (!container) return;

      const hoje = dataArr.filter(p => p.dia === diaHoje && p.mes === mesHoje);

      if (pill) pill.textContent = `${hoje.length} encontrado(s)`;
      if (sub) {
        const fmt = now.toLocaleDateString(currentLocale, {
          weekday: "long",
          day: "2-digit",
          month: "long"
        });
        sub.textContent = fmt.charAt(0).toUpperCase() + fmt.slice(1);
      }

      if (!hoje.length) {
        const next = [...dataArr]
          .map(p => ({ ...p, diff: daysDiffFromToday(p.dia, p.mes) }))
          .filter(p => p.diff >= 0)
          .sort((a, b) => a.diff - b.diff)[0];

        if (!next) {
          container.textContent = "Nenhum aniversariante cadastrado.";
          return;
        }

        const labelDate = formatDayMonth(next.dia, next.mes);
        const diffTxt = next.diff === 0 ? "hoje" :
                        next.diff === 1 ? "em 1 dia" :
                        `em ${next.diff} dias`;
        container.innerHTML =
          `Nenhum aniversariante hoje ‚Äî pr√≥ximo: <strong>${next.nome}</strong> em ${labelDate} (${diffTxt}).`;
        return;
      }

      // h√° aniversariantes hoje
      const items = hoje
        .map(p =>
          `<div class="person-row">
            <div class="avatar" aria-hidden="true">
              ${p.nome.substring(0, 2).toUpperCase()}
            </div>
            <div class="person-main">
              <div class="person-name">${p.nome}</div>
              <div class="person-meta">
                ${p.setor ? `${p.setor} ‚Ä¢ ` : ""} Hoje, ${formatLongDate(p.dia, p.mes)}
              </div>
            </div>
          </div>`
        )
        .join("");

      container.innerHTML = items;
    }

    // ---------------- RENDER: PR√ìXIMOS 5 DIAS (HOME) ----------------
    function renderHomeUpcoming() {
      const box = $("#home-upcoming");
      if (!box) return;
      const maxDays = 5;
      const items = [...dataArr]
        .map(p => ({ ...p, diff: daysDiffFromToday(p.dia, p.mes) }))
        .filter(p => p.diff >= 1 && p.diff <= maxDays)
        .sort((a, b) => a.diff - b.diff || sortByDateThenName(a, b));

      if (!items.length) {
        box.textContent = "Nenhum aniversariante nos pr√≥ximos 5 dias.";
        return;
      }

      const html = items
        .map(p => {
          const diffTxt = p.diff === 1 ? "amanh√£" : `em ${p.diff} dias`;
          const dt = formatDayMonth(p.dia, p.mes);
          return `<div class="person-row">
            <div class="avatar" aria-hidden="true">${p.nome.substring(0,2).toUpperCase()}</div>
            <div class="person-main">
              <div class="person-name">${p.nome}</div>
              <div class="person-meta">
                ${p.setor ? `${p.setor} ‚Ä¢ ` : ""}${dt} (${diffTxt})
              </div>
            </div>
          </div>`;
        })
        .join("");

      box.innerHTML = html;
    }

    // ---------------- RENDER: CALEND√ÅRIO ----------------
    function renderCalendar() {
      const grid = $("#calendar-grid");
      const label = $("#calendar-month-label");
      const summary = $("#calendar-summary");
      if (!grid) return;

      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth(); // 0-11
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const numDays = lastDay.getDate();
      const offset = firstDay.getDay(); // 0=domingo

      const monthName = firstDay.toLocaleDateString(currentLocale, {
        month: "long",
        year: "numeric"
      });
      if (label) label.textContent = `M√™s atual: ${monthName}`;

      // mapa dia -> aniversariantes
      const map = {};
      dataArr.forEach(p => {
        if (p.mes === month + 1) {
          if (!map[p.dia]) map[p.dia] = [];
          map[p.dia].push(p);
        }
      });
      Object.values(map).forEach(list => list.sort(sortByDateThenName));

      const cells = [];

      // espa√ßos em branco antes do 1¬∫ dia
      for (let i = 0; i < offset; i++) {
        cells.push('<div class="day-cell" aria-hidden="true"></div>');
      }

      // dias do m√™s
      for (let d = 1; d <= numDays; d++) {
        const people = map[d] || [];
        const badges = people
          .map(p =>
            `<div class="day-badge">
              üéÇ ${p.nome}
            </div>`
          )
          .join("");

        cells.push(`
          <div class="day-cell">
            <div class="day-num">${d}</div>
            ${badges || ""}
          </div>
        `);
      }

      grid.innerHTML = cells.join("");

      if (summary) {
        const totalMonth = Object.values(map).reduce((acc, arr) => acc + arr.length, 0);
        summary.textContent =
          totalMonth === 0
            ? "Nenhum aniversariante neste m√™s."
            : `Este m√™s possui ${totalMonth} aniversariante(s) cadastrado(s).`;
      }
    }

    // ---------------- RENDER: LISTA COMPLETA ----------------
    function getFilteredList() {
      const search = ($("#search-input")?.value || "").toLowerCase().trim();
      const monthVal = $("#month-filter")?.value || "all";

      return dataArr.filter(p => {
        if (monthVal !== "all" && Number(p.mes) !== Number(monthVal)) return false;

        if (!search) return true;
        const nome = (p.nome || "").toLowerCase();
        const setor = (p.setor || "").toLowerCase();
        return nome.includes(search) || setor.includes(search);
      });
    }

    function renderList(reset = false) {
      const wrapper = $("#list-wrapper");
      const loadMore = $("#load-more");
      if (!wrapper) return;

      if (reset) listShown = 30;
      const filtered = getFilteredList();
      const sliced = filtered.slice(0, listShown);

      if (!sliced.length) {
        wrapper.textContent = "Nenhum aniversariante encontrado.";
        if (loadMore) loadMore.style.display = "none";
        return;
      }

      let html = `
        <table aria-label="Tabela de aniversariantes">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Setor</th>
              <th>Data</th>
              <th style="text-align:right;">A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
      `;

      html += sliced
        .map(p => {
          const dateLabel = formatDayMonth(p.dia, p.mes);
          const actions = isAdmin
            ? `
              <div class="table-actions">
                <button class="icon-btn edit-btn" data-id="${p.id}" title="Editar">
                  <i class="fa-solid fa-pen"></i>
                </button>
                <button class="icon-btn del-btn" data-id="${p.id}" title="Excluir">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>`
            : "";

          return `
            <tr>
              <td>${p.nome}</td>
              <td>${p.setor || "‚Äî"}</td>
              <td>${dateLabel}</td>
              <td>${actions}</td>
            </tr>`;
        })
        .join("");

      html += "</tbody></table>";
      wrapper.innerHTML = html;

      if (loadMore) {
        loadMore.style.display = filtered.length > listShown ? "inline-flex" : "none";
      }
    }

    // ---------------- RENDER: FUTUROS (P√ÅGINA) ----------------
    function renderFuturePage() {
      const box = $("#future-list");
      const daysInput = $("#days-ahead");
      if (!box || !daysInput) return;

      const range = Math.min(Math.max(Number(daysInput.value) || 30, 1), 365);
      const items = [...dataArr]
        .map(p => ({ ...p, diff: daysDiffFromToday(p.dia, p.mes) }))
        .filter(p => p.diff >= 1 && p.diff <= range)
        .sort((a, b) => a.diff - b.diff || sortByDateThenName(a, b));

      if (!items.length) {
        box.textContent = `Nenhum aniversariante nos pr√≥ximos ${range} dias.`;
        return;
      }

      const html = items
        .map(p => {
          const diffTxt = p.diff === 1 ? "amanh√£" : `em ${p.diff} dias`;
          const longDate = formatLongDate(p.dia, p.mes);
          return `
            <div class="person-row">
              <div class="avatar" aria-hidden="true">
                ${p.nome.substring(0,2).toUpperCase()}
              </div>
              <div class="person-main">
                <div class="person-name">${p.nome}</div>
                <div class="person-meta">
                  ${p.setor ? `${p.setor} ‚Ä¢ ` : ""}${longDate} (${diffTxt})
                </div>
              </div>
            </div>
          `;
        })
        .join("");

      box.innerHTML = html;
    }

    // ---------------- RENDER: GR√ÅFICOS ----------------
    function renderCharts() {
      const ctxEl = $("#chart-monthly");
      const summary = $("#charts-summary");
      if (!ctxEl || !window.Chart) return;

      const counts = new Array(12).fill(0);
      dataArr.forEach(p => {
        if (p.mes >= 1 && p.mes <= 12) counts[p.mes - 1] += 1;
      });

      const labelsBR = ["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
      const labelsEN = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
      const labels = currentLocale === "pt-BR" ? labelsBR : labelsEN;

      if (chart) chart.destroy();
      chart = new Chart(ctxEl.getContext("2d"), {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "Aniversariantes",
            data: counts
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { precision: 0 }
            }
          }
        }
      });

      if (summary) {
        const total = counts.reduce((a, b) => a + b, 0);
        const max = Math.max(...counts);
        const min = Math.min(...counts.filter(v => v > 0)) || 0;
        const maxIndex = counts.indexOf(max);
        const minIndex = counts.indexOf(min);

        if (!total) {
          summary.textContent = "Nenhum dado para exibir.";
        } else {
          const monthMax = labels[maxIndex];
          const monthMin = min ? labels[minIndex] : null;
          summary.textContent = monthMin
            ? `Total geral: ${total}. M√™s com mais anivers√°rios: ${monthMax} (${max}). M√™s com menos anivers√°rios (n√£o nulo): ${monthMin} (${min}).`
            : `Total geral: ${total}. M√™s com mais anivers√°rios: ${monthMax} (${max}).`;
        }
      }
    }

    function renderEverything() {
      renderToday();
      renderHomeUpcoming();
      renderCalendar();
      renderList(true);
      renderFuturePage();
      renderCharts();
    }

    // ---------------- CRUD: MODAIS ----------------
    function openEditModal(item = null) {
      const dlg = $("#edit-modal");
      if (!dlg) return;
      $("#edit-heading").textContent = item ? "Editar aniversariante" : "Novo aniversariante";
      $("#edit-id").value = item?.id || "";
      $("#edit-nome").value = item?.nome || "";
      $("#edit-setor").value = item?.setor || "";
      $("#edit-dia").value = item?.dia || "";
      $("#edit-mes").value = item?.mes || "";
      dlg.showModal();
    }

    function openConfirmModal(item) {
      const dlg = $("#confirm-modal");
      if (!dlg) return;
      $("#confirm-text").textContent =
        `Tem certeza que deseja excluir "${item.nome}" (${formatDayMonth(item.dia, item.mes)})?`;
      dlg.dataset.id = item.id;
      dlg.showModal();
    }

    function initCrudEvents() {
      const addBtn = $("#add-btn");
      const editDlg = $("#edit-modal");
      const confirmDlg = $("#confirm-modal");

      if (addBtn) {
        addBtn.addEventListener("click", () => openEditModal(null));
      }

      if (editDlg) {
        $("#edit-cancel").addEventListener("click", () => editDlg.close());
        $("#edit-form").addEventListener("submit", async ev => {
          ev.preventDefault();
          const id = $("#edit-id").value || null;
          const nome = $("#edit-nome").value.trim();
          const setor = upperSetor($("#edit-setor").value);
          const dia = Number($("#edit-dia").value);
          const mes = Number($("#edit-mes").value);

          if (!nome || !dia || !mes) {
            showToast("Preencha todos os campos.", "error");
            return;
          }

          try {
            if (id) {
              await setDoc(doc(db, "aniversariantes", id), { nome, setor, dia, mes }, { merge: true });
              const idx = dataArr.findIndex(x => x.id === id);
              if (idx >= 0) dataArr[idx] = { id, nome, setor, dia, mes };
              showToast("Registro atualizado.");
            } else {
              const ref = await addDoc(colRef, { nome, setor, dia, mes });
              dataArr.push({ id: ref.id, nome, setor, dia, mes });
              showToast("Registro criado.");
            }
            dataArr.sort(sortByDateThenName);
            renderEverything();
            editDlg.close();
          } catch (err) {
            console.error(err);
            showToast("Erro ao salvar registro.", "error");
          }
        });
      }

      if (confirmDlg) {
        $("#confirm-no").addEventListener("click", () => confirmDlg.close());
        $("#confirm-yes").addEventListener("click", async () => {
          const id = confirmDlg.dataset.id;
          if (!id) return;
          try {
            await deleteDoc(doc(db, "aniversariantes", id));
            dataArr = dataArr.filter(x => x.id !== id);
            renderEverything();
            showToast("Registro exclu√≠do.");
          } catch (err) {
            console.error(err);
            showToast("Erro ao excluir registro.", "error");
          } finally {
            confirmDlg.close();
          }
        });
      }

      // Delega√ß√£o de eventos nos bot√µes de a√ß√£o da tabela
      const listWrapper = $("#list-wrapper");
      if (listWrapper) {
        listWrapper.addEventListener("click", ev => {
          const editBtn = ev.target.closest(".edit-btn");
          const delBtn = ev.target.closest(".del-btn");
          if (editBtn) {
            const id = editBtn.dataset.id;
            const item = dataArr.find(x => x.id === id);
            if (item) openEditModal(item);
          } else if (delBtn) {
            const id = delBtn.dataset.id;
            const item = dataArr.find(x => x.id === id);
            if (item) openConfirmModal(item);
          }
        });
      }
    }

    // ---------------- AUTENTICA√á√ÉO ----------------
    function initAuth() {
      const authBtn = $("#auth-btn");
      const loginDlg = $("#login-modal");

      if (authBtn) {
        authBtn.addEventListener("click", () => {
          if (isAdmin) {
            signOut(auth).catch(() => {});
          } else {
            loginDlg?.showModal();
          }
        });
      }

      if (loginDlg) {
        $("#login-close").addEventListener("click", () => loginDlg.close());
        $("#login-form").addEventListener("submit", async ev => {
          ev.preventDefault();
          const email = $("#login-email").value.trim();
          const pass  = $("#login-pass").value.trim();
          if (!email || !pass) return;

          try {
            await signInWithEmailAndPassword(auth, email, pass);
            loginDlg.close();
            showToast("Login efetuado com sucesso.");
          } catch (err) {
            console.error(err);
            showToast("Falha no login. Verifique as credenciais.", "error");
          }
        });
      }

      onAuthStateChanged(auth, user => {
        isAdmin = !!user;
        updateAdminUI();
      });
    }

    // ---------------- A√á√ïES DA INTERFACE ----------------
    function initUIEvents() {
      // Tema
      const themeBtn = $("#theme-toggle");
      if (themeBtn) {
        themeBtn.addEventListener("click", () => {
          const current = document.body.getAttribute("data-theme") || "light";
          setTheme(current === "light" ? "dark" : "light");
        });
      }

      // Locale
      const localeSelect = $("#locale-select");
      if (localeSelect) {
        localeSelect.addEventListener("change", () => setLocale(localeSelect.value));
        localeSelect.value = currentLocale;
      }
      setLocale(currentLocale);

      // Busca / filtro / load more
      const searchInput = $("#search-input");
      const monthFilter = $("#month-filter");
      const loadMore = $("#load-more");
      if (searchInput) searchInput.addEventListener("input", () => renderList(true));
      if (monthFilter) monthFilter.addEventListener("change", () => renderList(true));
      if (loadMore) {
        loadMore.addEventListener("click", () => {
          listShown += 30;
          renderList(false);
        });
      }

      // Futuros ‚Äì range
      const daysInput = $("#days-ahead");
      const refreshBtn = $("#refresh-future");
      if (daysInput && refreshBtn) {
        refreshBtn.addEventListener("click", renderFuturePage);
        daysInput.addEventListener("keydown", ev => {
          if (ev.key === "Enter") {
            ev.preventDefault();
            renderFuturePage();
          }
        });
      }

      // Export CSV
      const exportBtn = $("#export-csv");
      if (exportBtn) {
        exportBtn.addEventListener("click", () => {
          if (!dataArr.length) {
            showToast("Nenhum dado para exportar.", "error");
            return;
          }
          const header = "nome,setor,dia,mes\n";
          const rows = dataArr
            .map(p => `"${p.nome.replace(/"/g, '""')}",` +
                      `"${(p.setor || "").replace(/"/g, '""')}",` +
                      `${p.dia},${p.mes}`)
            .join("\n");
          const blob = new Blob([header + rows], { type: "text/csv;charset=utf-8;" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "aniversariantes_export.csv";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          showToast("CSV exportado.");
        });
      }

      // Import exemplo ‚Äì s√≥ para admins (arquivo de exemplo local)
      const importSample = $("#import-sample");
      if (importSample) {
        importSample.addEventListener("click", () => {
          showToast("Para importar, selecione um arquivo CSV pr√≥prio.", "ok");
        });
      }
    }

    // ---------------- INICIALIZA√á√ÉO GERAL ----------------
    function init() {
      initTheme();
      initTabs();
      initCelebrate();
      initAuth();
      initCrudEvents();
      initUIEvents();
      loadData();
    }

    window.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
